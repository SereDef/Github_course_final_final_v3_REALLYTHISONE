---
# revealjs-plugins:
#   - editable
# filters:
#   - editable
---

::: notes
Let's walk through some basic operations to confirm you have installed the necessary software and that the necessary connections are being made, between tools on your computer and between your computer and `GitHub`.
:::

# [Part 3] configuration

## Half the battle

Getting all the necessary software installed, configured, and playing nicely together is honestly *half the battle* when first adopting Git. 

You will find far more resources for *how to use Git* than for installation and configuration. Why? The experts …

- Have been doing this for years. It’s simply not hard for them anymore.
- Probably use some flavor of Unix. They may secretly (or not so secretly) take pride in neither using nor knowing Windows.
- Get more satisfaction and reward for thinking and writing about Git concepts and workflows than Git installation.
- In their defense, it’s hard to write installation instructions. Failures can be specific to an individual OS or even individual computer.

::: notes
Brace yourself for some pain. The upside is that you can give yourself a pat on the back once you get through this. And you WILL get through this.
:::

## Is R and RStudio up to date?

This is a great time to make sure your R installation is current. 

``` r
# Check your current R version 
R.version.string

# ... and update your R packages while at it
# (optional)
update.packages(ask = FALSE, checkBuilt = TRUE)
```
<br> 

::: {.callout-tip title="Tip of the day"}
You don’t want to adopt new things on day one. But at some point, running old versions of software adds unnecessary difficulty. **Get current, people.** 
:::

<br>

::: {.callout-note title="Is my R version *“old”*?"}
R had a major version change in April 2020, with the release of `4.0.0`. It is a good idea to be on the current major version, meaning **`4.something`**

Each major version is followed by several years of smaller releases (minor and patch releases). You can be more relaxed about upgrading minor versions, but you still want to stay reasonably current. I advise that you never fall **more than 1 minor version behind**.
:::

::: notes
Concrete example: let’s say the released version of R is 4.7.1, which is totally fictional and well beyond the current version of R at the time of writing. It’s probably OK if you are still on 4.6.whatever, which is one minor version behind and is called “r-oldrel”. Being one minor version behind usually doesn’t cause trouble. Once you are 2 minor versions behind (4.5.whatever or earlier in this example), you will start to suffer. In particular, you can no longer install pre-built binary add-on packages from CRAN.

Is your RStudio “old”? You can expect to update RStudio much more often than R itself. For example, I update RStudio every month or so, whereas I update R 1 or 2 times per year.
:::

## The shell

The shell is a program on your computer whose job is to run other programs. Pseudo-synonyms are `“terminal”`, `“command line”`, `“console”` or `bash`

Even if you do most of your `Git` operations via a *client* (e.g., `RStudio` or `GitHub`), you must sometimes work in the **shell**. 

In research, you usually see the command line when working on a **server** (that does not have a GUI client). 

As you get more comfortable with Git, you might prefer to do more and more via the command line. 

::: notes
Many programmers spend lots of time in a shell, as opposed to in GUIs, because it is very fast, concise, and ubiquitous in their relevant computing environments. This is how all work was done before we got the mouse and GUIs.

The most common shell is bash and it gets thrown around as a proxy for “shell” sometimes, just like “Coke” and “Kleenex” are proxies for cola and tissues.

Sometimes we demo the use of a shell for certain tasks, like navigating the file system and doing Git operations, when we don’t want to or can’t use RStudio. Providing shell commands is also less ambiguous and less perishable than describing human interactions with a GUI.
For all these reasons, it is a good idea to learn your way around the shell.
:::

## Opening the shell

::: panel-tabset
### From  `RStudio`
It is often handy to launch a shell from `RStudio`, because it makes an effort to put you in a sane working directory (in the current project).



To launch a shell within `RStudio`: *Tools > Terminal* 

### macOS
The shell is often called the **“terminal”**. 

<br>

One way to launch it is via Spotlight Search: hit `Command``Space` and start typing *“terminal”*.

### Windows is special... not in a good way
::: {.column width="70%"}
There are many possible shells you can end up in. 

Unless you know better, use the **`Git Bash`** shell. This is a bash shell that ships with `Git` for Windows (so, you will not have it on your system until you install `Git`).

* RStudio should automatically detect the presence of `Git Bash`. <br> You can inspect and influence this via *Tools > Global Options > Terminal*. 
* To access `Git Bash` outside of RStudio: open the the Windows menu, click on the “Git” folder and select “Git Bash”.
:::

![](imgs/git-bash-windows.png){.absolute bottom=0 right=10 width=450}

:::

::: notes
Windows is not the ideal platform for scientific computing and software development. A lot of the functionality is going to feel janky and strapped on. Because it is.
:::

## Is `Git` installed?
Go to the shell and type: 

``` sh
which git
```
This should give you the path to your `Git` executable.

Let's also check which version you are using:

``` sh
git --version
```
If you see something more like `git: command not found` you (likely) don't have `Git` intalled, let's fix that.

## Install `Git`

You need `Git`, so let's install it.
<br><br>

::: panel-tabset
### Windows
Install [Git for Windows](https://gitforwindows.org/), also known as `msysgit` or **“Git Bash”**, to get `Git` in addition to some other useful tools, such as the `Bash shell`.

> NOTE: When asked about *“Adjusting your PATH environment”*, make sure to select **“Git from the command line and also from 3rd-party software”**. Otherwise, accept the defaults.

You should now have a `Git` executable `C:/Program Files/Git/bin/git.exe`.

### macOS
Install the **Xcode** command line tools (not all of Xcode), which includes `Git`.

<br>
In the terminal type:
``` sh
xcode-select --install
```

### Linux
Install `Git` via your distro’s package manager.

<br>

Ubuntu or Debian:
``` sh
sudo apt-get install git
```
Fedora or RedHat:
``` sh
sudo yum install git
```
:::

## Introduce yourself to `Git`

::: panel-tabset

### In the shell

<br>

``` sh
git config --global user.name "Serena Defina"
git config --global user.email "sere.def@gmail.com"
```

> What user name should I give to `Git`? This doesn't matter. Your commits will be labelled with this user name though, so make it informative to potential collaborators and future you.

> What email should you give to `Git`? This <ins>must</ins> be the email associated with your `GitHub` account.

<br>

Check what happened:
``` sh
git config --global --list
```

More things you can do with `git config`: [Software Carpentry](https://swcarpentry.github.io/git-novice/02-setup.html)

### In R
You can also set your `Git` user name and email from within `R` thanks to the `usethis` package.

``` r
# Install usethis (if needed)
# install.packages("usethis") # or pak::pak("usethis")

library(usethis) 
use_git_config(user.name = "Serena Defina", user.email = "sere.def@gmail.com")
```
> I do quite a bit of R package dev, so I have `library(usethis)` in my `.Rprofile` file.
:::

## Can you hear me now?
So you have `Git` working on your local machine (yey). Now it's time to talk to `GitHub`.
<br><br> 

::: {.fragment}
`GitHub` is a [remote `Git` server]{.darkblue-bold}. To interact with it, we have to use **credentials** in the request. This proves we are a specific `GitHub` user, who’s allowed to do whatever we’re asking to do.<br><br> 
:::
:::{.fragment}
There are two ways (or *"protocols"*) to communicate with a remote server: [HTTPS]{.orange-bold} and [SSH]{.orange-bold}, each uses different credentials.

* for HTTPS we will use a **personal access token (PAT)**
* for SSH we will use **SSH keys**

:::{.callout-tip title="HTTPS or SSH?"}
GitHub recommends HTTPS, presumably becasue it is easier to get working. Especially for Windows users, I would stick to HTTPS. Tech-y people will die on the SSH hill.

Anyway, don't worry too much. This is not an all-or-nothing decision and it’s a relatively easy to revisit later. 
:::
:::

::: notes
We want to establish a two-way communication street (i.e. `pull` and `push`) between two computers..

Unfortunately, we have to front-load a rather fiddly task: decide whether to communicate with `GitHub` via **HTTPS** or **SSH** and setup some credentials accordingly.

These are kind of like passwords, but better.

Another advantage of HTTPS: there are many R packages that call GitHub’s API on your behalf (devtools+usethis, remotes, pak, gh, etc.). Configuring your PAT kills two birds with one stone: this single credential can be used to authenticate to GitHub as a regular Git server and for its REST API. If you authenticate via SSH for “regular” Git work, you will still have to set up a PAT for work that uses the REST API.
:::

## Set up personal access tokens (PAT) for HTTPS
::: panel-tabset

### In R

<br>

``` r
usethis::create_github_token()
```
Copy the generated PAT to your clipboard.

You can provide this PAT next time a `Git` operation asks for your *password* (I know, this is very confusing)

<br>...But best to store the PAT explicitly right now. 

In R, call:
``` r
gitcreds::gitcreds_set() 
``` 

Paste the PAT in response to the dialogue in the console.

<br>**All done!** Check your set-up with: 
``` r
usethis::git_sitrep()
``` 

### On GitHub
*Assuming you are signed in

Go here: [https://github.com/settings/tokens](https://github.com/settings/tokens)

> Click on your profile icon (top right corner) > Settings > Developer Settings (at end of the sidebar menu) > Personal access tokens > Tokens (classic) 

Click on *Generate new token > Generate new token (classic)*

Select scopes: `“repo”`, `“user”`, and `“workflow”` (default from `usethis`)

Click *Generate token*.

Copy the generated PAT to your clipboard.

Provide this PAT next time a `Git` operation asks for your password.

<br>...or store it in your favourite password manager.
:::

## Set up keys for SSH
Here is what is going to happen: 

- We'll generate a **key pair** (i.e. two long strings of characters) a *public* and a *private* key. 
- We'll place the *public* key on a *server* (aka `GitHub`!), 
- We'll add the *private* key to our `ssh-agent` on the *client* (aka your computer!). 
- When the two match up, the system unlocks without the need for a password. Magic.

:::{.callout-tip title="Some advice"}
It's normal to associate multiple public keys with your GitHub account. You should probably have one key pair per computer (at least, I do this).<br><br>
You can increase security even more by protecting the private key with a passphrase. <br>
However, that requires some additional configuration (nothing mad, have a google at it)
:::

::: notes
Create a public-private SSH key pair. Literally, 2 special files, in a special place. Optionally, encrypt the private key with a passphrase (best practice).
:::

## Step 1: generate SSH keys

::: panel-tabset

### From   `RStudio`
Go to *Tools > Global Options… > Git/SVN > Create SSH Key…* <br><br>

`RStudio` prompts you for a (optional) passphrase.

If you’re completely new at all this, I'd reccomend skipping the passphrase for now and implement it next time, when you are more comfortable with system configuration.<br><br>

Click *“Create”* and `RStudio` will generate an SSH key pair, stored in the files `~/.ssh/id_ed25519` and `~/.ssh/id_ed25519.pub`.

:::{.callout-note}
The typical pattern is `id_<something>.pub` (the public key) and `id_<something>` (the private key), where `<something>` reflects the key *type*.

`rsa` historically has been the most common. However, these days `GitHub` encourages users to generate SSH keys with the `ed25519` algorithm instead (default option).
:::

### From the shell
Create the key pair like so (a meaningful comment could be the name of your computer, for example)
``` sh
ssh-keygen -t ed25519 -C "DESCRIPTIVE-COMMENT"
```
If your system is too old to support the Ed25519 algorithm, substitute "ed25519" with "rsa -b 4096".

Accept the proposal to save the key in the default location (Just press Enter)

You have the option to protect the key with a passphrase. If you’re completely new at all this, skip the passphrase and implement it next time, when you are more comfortable with system configuration. 



:::

## Step 2: client
Tell your `ssh-agent` about the key (and set it up to manage the passphrase, if you chose to set one).

Things get a little OS-specific around here. When in doubt, consult [GitHub’s instructions for SSH](https://docs.github.com/en/authentication/connecting-to-github-with-ssh), which is kept current and accounts for more unusual situations than I can.

::: panel-tabset
### On Linux or macOS
Make sure ssh-agent is enabled
``` sh
eval "$(ssh-agent -s)"
```
You should see something like "Agent pid <some number>". 

If this fails try again, as the superuser (`sudo su` > `eval "$(ssh-agent -s)"` > `exit`).

Add your key to the ssh agent. If you set a passphrase, you’ll be challenged for it here.
``` sh
ssh-add ~/.ssh/id_ed25519
```

### On Windows
In the `Git Bash` shell, make sure ssh-agent is enabled:
``` sh
eval $(ssh-agent -s)
```
You should see something like "Agent pid <some number>". 

Add your key to the ssh agent.
``` sh
ssh-add ~/.ssh/id_ed25519
```
:::

## Step 3: server
Now the last thing we need to do is store a copy of your public key on `GitHub`.

1. Copy the public key onto your clipboard. 

::: panel-tabset

### In RStudio
Go to *Tools > Global Options… > Git/SVN*. 

You should see something like `~/.ssh/id_ed25519` in the SSH Key box.

Click on *“View public key”* and copy that to your clipboard.

### In the shell
List existing keys:
```sh
ls -al ~/.ssh/
```

Open the `~/.ssh/id_ed25519.pub` file in whatever editor and copy the contents to your clipboard. 

Some examples: `pbcopy < ~/.ssh/id_ed25519.pup` (on macOS), `xclip -sel clip < ~/.ssh/id_ed25519.pub` (on Linux), `clip < ~/.ssh/id_ed25519.pub` (on Windows)

:::
<br>
2. Got to `GitHub` and register the public key

> Click on your profile pic (upper right corner) > Settings > SSH and GPG keys > New SSH key. Paste your public key in the “Key” box. Give it an informative title (e.g. the descriptive comment you used during key creation). Click “Add SSH key”.

<br>Done! But let's test this to be sure:
```sh
ssh -T git@github.com
```


## Questions?

No? thank god let's have a break 